---
title: "从微服务的反模式联想到微前端"
date: 2021-10-26T23:49:44+08:00
draft: false
---

微前端借鉴了微服务的思想，因此我联想到可以从微服务的反模式吸取经验，更好地落地微前端。

微服务架构的好处包括便于测试，快速，易于部署，细粒度的可扩展性，模块化和敏捷性。然而，开发微服务的时候陷入了服务粒度，数据迁移，组织形式改变和分布式处理的斗争中。

## 典型的微服务反模式

### 服务粒度地狱

服务粒度至关重要，它会影响应用的性能、健壮性、可靠性、可测性、甚至发布模型。

服务粒度应该随着业务渐进式发展，但是社区提供了衡量服务粒度的参考。

衡量服务粒度的标准包括：

1. 服务的范围/功能：当一个操作和基本的CRUD操作无关，那么大概率应该拆分为单独的服务
2. 数据库事务：如果不能实现ACID事务，那么大概率要拆分为多个微服务，并达成最终一致性
3. 服务编排的复杂度：当一个逻辑需要调用多个服务时，服务粒度可能太细

### 依赖地狱

微服务是一种无共享的架构，但是总有一些代码会在微服务之间共享。比如不提供一个身份验证的微服务，而是将身份验证的代码打包成一个jar文件：security.jar，其它服务都能使用。如果安全检查是服务级别的功能，每个服务接收到请求都会检查安全性，这种方式可以很好的提高性能。

但是这会引起依赖地狱。（依赖过多，多重依赖，依赖冲突，依赖循环）最终导致系统性问题，例如安装大量依赖或无法工作。

典型场景包括4种：共享仓库，共享类库，复制，整合（整合可能是相对优雅的依赖处理方案，做成一个单独的服务）

### 其他

数据迁移和分布式处理与前端的关联似乎不紧密。

## 微前端反模式

结合微服务的反模式，我总结了两个典型问题的对策。

### 粒度地狱

可以分析以下几个关键问题，确认是否进行拆分：

1. 性能：评估白屏时间、秒开率，以及完成核心业务流程需要经历的操作、页面跳转
2. 可靠性：评估是否容易被其他业务影响
3. 可测性：评估当前页面是否大量依赖其他业务的流程、数据
4. 发布模型：评估能否独立发布，业务闭环

### 依赖地狱

可以分析以下几个关键问题：

1. 数量：依赖数量避免过多
2. 形式：NPM包、平台服务（SSO、权限等）、共享仓库、DLL js等
3. 可用性：依赖的测试质量、SLA等
4. 维护团队：评估维护团队是否可靠

